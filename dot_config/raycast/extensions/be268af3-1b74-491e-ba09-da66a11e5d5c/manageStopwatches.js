"use strict";var M=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Z=Object.prototype.hasOwnProperty;var tt=(t,e)=>{for(var n in e)M(t,n,{get:e[n],enumerable:!0})},et=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of X(e))!Z.call(t,s)&&s!==n&&M(t,s,{get:()=>e[s],enumerable:!(o=Q(e,s))||o.enumerable});return t};var nt=t=>et(M({},"__esModule",{value:!0}),t);var it={};tt(it,{default:()=>K});module.exports=nt(it);var r=require("@raycast/api"),z=require("react");var E=require("@raycast/api"),R=require("react");var S=t=>{let e=Math.floor(t/3600),n=String(Math.floor(t%3600/60)).padStart(2,"0"),o=String(Math.floor(t%60)).padStart(2,"0");return`${e===0?"":e+":"}${n}:${o}`},L=t=>{let e=new Date(t),n=[e.getFullYear().toString(),(e.getMonth()+1).toString().padStart(2,"0"),e.getDate().toString().padStart(2,"0")],o=[e.getHours(),e.getMinutes(),e.getSeconds()].map(T=>T.toString().padStart(2,"0")),s=n.join("-"),f=o.join(":");return`${s} ${f}`},h=t=>(t.d1=t.d1=="----"?void 0:t.d1,t.d2=t.d2=="----"?void 0:t.d2,Math.round((t.d1?new Date(t.d1):new Date).getTime()-(t.d2?new Date(t.d2):new Date).getTime())/1e3);var y=require("@raycast/api"),W=require("child_process"),B=require("crypto"),i=require("fs"),V=require("path");var l=require("@raycast/api");var P=t=>{let e=(0,l.getPreferenceValues)();if(t.launchedFromMenuBar||e.closeWindowOnTimerStart){let n=t.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,l.showHUD)(`${n} ${t.msg}`),(0,l.popToRoot)()}else(0,l.showToast)({style:t.isErr?l.Toast.Style.Failure:l.Toast.Style.Success,title:t.msg})};var c=y.environment.supportPath+"/raycast-stopwatches.json",g=()=>{(!(0,i.existsSync)(c)||(0,i.readFileSync)(c).toString()=="")&&(0,i.writeFileSync)(c,"[]")},v=t=>({name:t,swID:(0,B.randomUUID)(),timeStarted:new Date,timeElapsed:-99,lastPaused:"----",pauseElapsed:0}),ot=t=>(t.map(e=>{if(e.lastPaused!="----")e.timeElapsed=Math.max(0,h({d1:e.lastPaused,d2:e.timeStarted})-e.pauseElapsed);else{let n=Math.max(0,h({d2:e.timeStarted}));e.timeElapsed=n-e.pauseElapsed}}),t),k=()=>{g();let t=JSON.parse((0,i.readFileSync)(c).toString()),e=rt(t),n=ot(e);return n.sort((o,s)=>o.timeElapsed-s.timeElapsed),n},x=async({swName:t="Untitled",launchedFromMenuBar:e=!1})=>{g();let n=JSON.parse((0,i.readFileSync)(c).toString()),o=v(t);n.push(o),(0,i.writeFileSync)(c,JSON.stringify(n)),P({msg:`Stopwatch "${t}" started!`,launchedFromMenuBar:e,isErr:!1})},U=t=>{g();let e=JSON.parse((0,i.readFileSync)(c).toString());e=e.map(n=>n.swID==t?{...n,lastPaused:new Date}:n),(0,i.writeFileSync)(c,JSON.stringify(e))},_=t=>{g();let e=JSON.parse((0,i.readFileSync)(c).toString());e=e.map(n=>n.swID==t?{...n,pauseElapsed:n.pauseElapsed+h({d2:n.lastPaused}),lastPaused:"----"}:n),(0,i.writeFileSync)(c,JSON.stringify(e))},H=t=>{g();let e=JSON.parse((0,i.readFileSync)(c).toString());e=e.filter(n=>n.swID!==t),(0,i.writeFileSync)(c,JSON.stringify(e))},rt=t=>((0,i.readdirSync)(y.environment.supportPath).forEach(n=>{if((0,V.extname)(n)==".stopwatch"){let o=v((0,i.readFileSync)(y.environment.supportPath+"/"+n).toString()),s=n.replace(/__/g,":").replace(".stopwatch","");o.timeStarted=new Date(s),o.timeElapsed=Math.max(0,h({})),(0,W.execSync)(`rm "${y.environment.supportPath}/${n}"`),t.push(o)}}),(0,i.writeFileSync)(c,JSON.stringify(t)),t),j=(t,e)=>{g();let o=JSON.parse((0,i.readFileSync)(c,"utf8")).map(s=>s.swID==t?{...s,name:e}:s);(0,i.writeFileSync)(c,JSON.stringify(o))};function b(){let[t,e]=(0,R.useState)(void 0),[n,o]=(0,R.useState)(t===void 0),s=()=>{let a=k();e(a),o(!1)},f=a=>{x(a),s()},T=a=>{U(a),s()},I=a=>{_(a),s()},N=a=>{(0,E.getPreferenceValues)().copyOnSwStop&&E.Clipboard.copy(S(a.timeElapsed)),H(a.swID),s()};return{stopwatches:t,isLoading:n,refreshSWes:s,handleRestartSW:a=>{N(a),f({swName:a.name,launchedFromMenuBar:!1}),s()},handleStartSW:f,handleStopSW:N,handlePauseSW:T,handleUnpauseSW:I}}var w=require("@raycast/api");var p=require("@raycast/api");var D=require("@raycast/api");var d=require("fs");var C=D.environment.supportPath+"/customTimers.json",Tt=D.environment.supportPath+"/defaultPresetVisibles.json";function G(t,e){let n=D.environment.supportPath+"/"+t;(0,d.writeFileSync)(n,e)}function st(){(0,d.existsSync)(C)||(0,d.writeFileSync)(C,JSON.stringify({}))}function Y(t,e){st();let n=JSON.parse((0,d.readFileSync)(C,"utf8"));n[t].name=e,(0,d.writeFileSync)(C,JSON.stringify(n))}var O=require("react/jsx-runtime");function q(t){let{pop:e}=(0,p.useNavigation)(),n=o=>{if(o===""||o===t.currentName)new p.Toast({style:p.Toast.Style.Failure,title:"No new name given!"}).show();else{switch(e(),t.originalFile){case"customTimer":Y(t.ctID?t.ctID:"-99",o);break;case"stopwatch":j(t.ctID?t.ctID:"-99",o);break;default:G(t.originalFile,o);break}P({msg:`Renamed to ${o}!`,launchedFromMenuBar:!1,isErr:!1})}};return(0,O.jsx)(p.Form,{actions:(0,O.jsx)(p.ActionPanel,{children:(0,O.jsx)(p.Action.SubmitForm,{title:"Rename",onSubmit:o=>n(o.newName)})}),children:(0,O.jsx)(p.Form.TextField,{id:"newName",title:"New name",placeholder:t.currentName})})}var F=require("react/jsx-runtime");function A(t){let{push:e}=(0,w.useNavigation)();return(0,F.jsx)(w.Action,{title:`Rename ${t.renameLabel}`,icon:w.Icon.TextInput,onAction:()=>e((0,F.jsx)(q,{currentName:t.currentName,originalFile:t.originalFile,ctID:t.ctID}))})}var m=require("react/jsx-runtime");function K(){let{stopwatches:t,isLoading:e,refreshSWes:n,handleRestartSW:o,handleStartSW:s,handleStopSW:f,handlePauseSW:T,handleUnpauseSW:I}=b();(0,z.useEffect)(()=>{n(),setInterval(()=>{n()},1e3)},[]);let N={tag:{value:"Paused",color:r.Color.Red}},$={tag:{value:"Running",color:r.Color.Green}},a={source:r.Icon.Clock,tintColor:r.Color.Red},J={source:r.Icon.Clock,tintColor:r.Color.Green};return(0,m.jsx)(r.List,{isLoading:e,children:(0,m.jsxs)(r.List.Section,{title:t?.length!==0&&t!=null?"Currently Running":"No Stopwatches Running",children:[t?.map(u=>(0,m.jsx)(r.List.Item,{icon:u.lastPaused=="----"?J:a,title:u.name,subtitle:S(u.timeElapsed)+" elapsed",accessories:[{text:"Started at "+L(u.timeStarted)},u.lastPaused=="----"?$:N],actions:(0,m.jsxs)(r.ActionPanel,{children:[u.lastPaused=="----"?(0,m.jsx)(r.Action,{title:"Pause Stopwatch",icon:r.Icon.Pause,onAction:()=>T(u.swID)}):(0,m.jsx)(r.Action,{title:"Unpause Stopwatch",icon:r.Icon.Play,onAction:()=>I(u.swID)}),(0,m.jsx)(A,{renameLabel:"Stopwatch",currentName:u.name,originalFile:"stopwatch",ctID:u.swID}),(0,m.jsx)(r.Action.CopyToClipboard,{title:"Copy Current Time",shortcut:{modifiers:["cmd"],key:"c"},content:S(u.timeElapsed)}),(0,m.jsx)(r.Action,{title:"Restart Stopwatch",icon:r.Icon.ArrowCounterClockwise,shortcut:{modifiers:["cmd"],key:"r"},onAction:()=>o(u)}),(0,m.jsx)(r.Action,{title:"Stop Stopwatch",icon:r.Icon.Stop,shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>f(u)})]})},u.swID)),(0,m.jsx)(r.List.Item,{icon:r.Icon.Clock,title:"Create a new stopwatch",subtitle:"Press Enter to start a stopwatch",actions:(0,m.jsx)(r.ActionPanel,{children:(0,m.jsx)(r.Action,{title:"Start Stopwatch",icon:r.Icon.Stopwatch,onAction:()=>s({})})})},0)]})})}
