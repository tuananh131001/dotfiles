"use strict";var M=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var H=(t,r)=>{for(var o in r)M(t,o,{get:r[o],enumerable:!0})},U=(t,r,o,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let m of _(r))!k.call(t,m)&&m!==o&&M(t,m,{get:()=>r[m],enumerable:!(a=L(r,m))||a.enumerable});return t};var W=t=>U(M({},"__esModule",{value:!0}),t);var j={};H(j,{default:()=>J});module.exports=W(j);var n=require("@raycast/api"),y=require("react");var f=require("@raycast/api"),O=[{title:"Alarm Clock",icon:f.Icon.Alarm,value:"alarmClock.wav"},{title:"Dismembered Woodpecker",icon:f.Icon.Bird,value:"dismemberedWoodpecker.wav"},{title:"Flute Riff",icon:f.Icon.Music,value:"fluteRiff.wav"},{title:"Level Up",icon:f.Icon.Trophy,value:"levelUp.wav"},{title:"Piano Chime",icon:f.Icon.Music,value:"pianoChime.wav"},{title:"Terminator",icon:f.Icon.BarCode,value:"terminator.wav"},{title:"Speak Timer Name",icon:f.Icon.Person,value:"speak_timer_name"}];var p=require("@raycast/api"),V=require("child_process"),B=require("crypto"),u=require("fs");var I=t=>{let r=Math.floor(t/3600),o=String(Math.floor(t%3600/60)).padStart(2,"0"),a=String(Math.floor(t%60)).padStart(2,"0");return`${r===0?"":r+":"}${o}:${a}`};var s=require("@raycast/api"),b=require("fs");var E=t=>{let r=(0,s.getPreferenceValues)();if(t.launchedFromMenuBar||r.closeWindowOnTimerStart){let o=t.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,s.showHUD)(`${o} ${t.msg}`),(0,s.popToRoot)()}else(0,s.showToast)({style:t.isErr?s.Toast.Style.Failure:s.Toast.Style.Success,title:t.msg})},$=async()=>{let t=s.environment.supportPath+"/ringContinuouslyWarningShown";if(!(0,s.getPreferenceValues)().ringContinuously||(0,b.existsSync)(t))return!0;let o=await(0,s.confirmAlert)({title:"Ring Continuously is enabled!",icon:s.Icon.Bell,message:'When the timer rings, you will need to use the "Stop Running Timer" command or stop the timer in the "Manage Timers" command to dismiss the sound. You can configure this in your Raycast settings.'});return o&&(0,b.writeFileSync)(t,""),o};var w=p.environment.supportPath+"/customTimers.json",ne=p.environment.supportPath+"/defaultPresetVisibles.json";var R=(t=!1)=>{let r=(0,p.getPreferenceValues)();return parseFloat(r.volumeSetting)>5?(E({msg:"Timer alert volume should not be louder than 5 (it can get quite loud!)",launchedFromMenuBar:t,isErr:!0}),!1):!0};async function A({timeInSeconds:t,timerName:r="Untitled",launchedFromMenuBar:o=!1,selectedSound:a="default"}){if(!await $())return;let c=(p.environment.supportPath+"/"+new Date().toISOString()+"---"+t+".timer").replace(/:/g,"__");(0,u.writeFileSync)(c,r);let d=(0,p.getPreferenceValues)(),S=`${p.environment.assetsPath+"/"+(a==="default"?d.selectedSound:a)}`,h=[`sleep ${t}`];h.push(`if [ -f "${c}" ]; then osascript -e 'display notification "Timer \\"${r}\\" complete" with title "Ding!"'`);let T=d.selectedSound==="speak_timer_name"?`say ${r}`:`afplay "${S}" --volume ${d.volumeSetting.replace(",",".")}`;if(h.push(T),d.ringContinuously){let g=`${c}`.replace(".timer",".dismiss");(0,u.writeFileSync)(g,".dismiss file for Timers"),h.push(`while [ -f "${g}" ]; do ${T}; done`)}h.push(`rm "${c}"; else echo "Timer deleted"; fi`),(0,V.exec)(h.join(" ; "),(g,N)=>{if(g){console.log(`error: ${g.message}`);return}if(N){console.log(`stderr: ${N}`);return}}),E({msg:`Timer "${r}" started for ${I(t)}!`,launchedFromMenuBar:o,isErr:!1})}function F(){(0,u.existsSync)(w)||(0,u.writeFileSync)(w,JSON.stringify({}))}function x(t){F();let r=JSON.parse((0,u.readFileSync)(w,"utf8"));r[(0,B.randomUUID)()]=t,(0,u.writeFileSync)(w,JSON.stringify(r))}var l=require("react/jsx-runtime");function J(t){let r=Object.values(t.arguments).some(e=>e!==""),[o,a]=(0,y.useState)(),[m,c]=(0,y.useState)(),[d,S]=(0,y.useState)(),{pop:h}=(0,n.useNavigation)(),T=(0,n.getPreferenceValues)(),g=e=>{if(F(),e.hours===""&&e.minutes===""&&e.seconds==="")new n.Toast({style:n.Toast.Style.Failure,title:"No values set for timer length!"}).show();else if(isNaN(Number(e.hours)))a("Hours must be a number!");else if(isNaN(Number(e.minutes)))c("Minutes must be a number!");else if(isNaN(Number(e.seconds)))S("Seconds must be a number!");else{if(!R())return;let i=e.name?e.name:"Untitled",D=3600*Number(e.hours)+60*Number(e.minutes)+Number(e.seconds);A({timeInSeconds:D,timerName:i,selectedSound:e.selectedSound}).then(()=>h()),e.willBeSaved&&x({name:e.name,timeInSeconds:D,selectedSound:e.selectedSound,showInMenuBar:!0})}},N=()=>{o&&o.length>0&&a(void 0)},v=()=>{m&&m.length>0&&c(void 0)},C=()=>{d&&d.length>0&&S(void 0)},P=[{id:"hours",title:"Hours",placeholder:"0",err:o,drop:N,validator:e=>{let i=e.target.value;isNaN(Number(i))?a("Hours must be a number!"):N()}},{id:"minutes",title:"Minutes",placeholder:"00",err:m,drop:v,validator:e=>{let i=e.target.value;isNaN(Number(i))?c("Minutes must be a number!"):v()}},{id:"seconds",title:"Seconds",placeholder:"00",err:d,drop:C,validator:e=>{let i=e.target.value;isNaN(Number(i))?S("Seconds must be a number!"):C()}}];return T.newTimerInputOrder!=="hhmmss"&&P.reverse(),(0,l.jsxs)(n.Form,{actions:(0,l.jsx)(n.ActionPanel,{children:(0,l.jsx)(n.Action.SubmitForm,{title:"Start Custom Timer",onSubmit:e=>g(e)})}),children:[P.map((e,i)=>(0,l.jsx)(n.Form.TextField,{id:e.id,title:e.title,placeholder:e.placeholder,defaultValue:t.arguments[e.id],error:e.err,onChange:e.drop,onBlur:e.validator},i)),(0,l.jsxs)(n.Form.Dropdown,{id:"selectedSound",defaultValue:"default",title:"Sound",children:[(0,l.jsx)(n.Form.Dropdown.Item,{value:"default",title:"Default"}),O.map((e,i)=>(0,l.jsx)(n.Form.Dropdown.Item,{title:e.value===T.selectedSound?`${e.title} (currently selected)`:e.title,value:e.value,icon:e.icon},i))]}),(0,l.jsx)(n.Form.TextField,{id:"name",title:"Name",placeholder:"Pour Tea",autoFocus:r}),(0,l.jsx)(n.Form.Checkbox,{id:"willBeSaved",label:"Save as preset"})]})}
