"use strict";var Q=Object.defineProperty;var Ce=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var Pe=Object.prototype.hasOwnProperty;var Ne=(e,t)=>{for(var n in t)Q(e,n,{get:t[n],enumerable:!0})},be=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ye(t))!Pe.call(e,s)&&s!==n&&Q(e,s,{get:()=>t[s],enumerable:!(r=Ce(t,s))||r.enumerable});return e};var Ie=e=>be(Q({},"__esModule",{value:!0}),e);var Oe={};Ne(Oe,{default:()=>we});module.exports=Ie(Oe);var c=require("@raycast/api"),Te=require("react");var Y=require("react");var S=require("@raycast/api"),ie=require("child_process"),se=require("crypto"),a=require("fs"),ae=require("path");var L=e=>{let t=Math.floor(e/3600),n=String(Math.floor(e%3600/60)).padStart(2,"0"),r=String(Math.floor(e%60)).padStart(2,"0");return`${t===0?"":t+":"}${n}:${r}`},ne=e=>{let t=new Date(e),n=[t.getFullYear().toString(),(t.getMonth()+1).toString().padStart(2,"0"),t.getDate().toString().padStart(2,"0")],r=[t.getHours(),t.getMinutes(),t.getSeconds()].map(i=>i.toString().padStart(2,"0")),s=n.join("-"),d=r.join(":");return`${s} ${d}`},z=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var u=require("@raycast/api"),U=require("fs");var V=e=>{let t=(0,u.getPreferenceValues)();if(e.launchedFromMenuBar||t.closeWindowOnTimerStart){let n=e.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,u.showHUD)(`${n} ${e.msg}`),(0,u.popToRoot)()}else(0,u.showToast)({style:e.isErr?u.Toast.Style.Failure:u.Toast.Style.Success,title:e.msg})},re=async()=>{let e=u.environment.supportPath+"/ringContinuouslyWarningShown";if(!(0,u.getPreferenceValues)().ringContinuously||(0,U.existsSync)(e))return!0;let n=await(0,u.confirmAlert)({title:"Ring Continuously is enabled!",icon:u.Icon.Bell,message:'When the timer rings, you will need to use the "Stop Running Timer" command or stop the timer in the "Manage Timers" command to dismiss the sound. You can configure this in your Raycast settings.'});return n&&(0,U.writeFileSync)(e,""),n};var C=S.environment.supportPath+"/customTimers.json",Je=S.environment.supportPath+"/defaultPresetVisibles.json",oe=e=>{try{(0,a.unlinkSync)(e)}catch(t){if(t instanceof Error&&!t.message.includes("ENOENT"))throw t}},x=(e=!1)=>{let t=(0,S.getPreferenceValues)();return parseFloat(t.volumeSetting)>5?(V({msg:"Timer alert volume should not be louder than 5 (it can get quite loud!)",launchedFromMenuBar:e,isErr:!0}),!1):!0};async function O({timeInSeconds:e,timerName:t="Untitled",launchedFromMenuBar:n=!1,selectedSound:r="default"}){if(!await re())return;let d=(S.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,a.writeFileSync)(d,t);let i=(0,S.getPreferenceValues)(),p=`${S.environment.assetsPath+"/"+(r==="default"?i.selectedSound:r)}`,I=[`sleep ${e}`];I.push(`if [ -f "${d}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let R=i.selectedSound==="speak_timer_name"?`say ${t}`:`afplay "${p}" --volume ${i.volumeSetting.replace(",",".")}`;if(I.push(R),i.ringContinuously){let D=`${d}`.replace(".timer",".dismiss");(0,a.writeFileSync)(D,".dismiss file for Timers"),I.push(`while [ -f "${D}" ]; do ${R}; done`)}I.push(`rm "${d}"; else echo "Timer deleted"; fi`),(0,ie.exec)(I.join(" ; "),(D,k)=>{if(D){console.log(`error: ${D.message}`);return}if(k){console.log(`stderr: ${k}`);return}}),V({msg:`Timer "${t}" started for ${L(e)}!`,launchedFromMenuBar:n,isErr:!1})}function me(e){let t=S.environment.supportPath+"/"+e,n=t.replace(".timer",".dismiss");oe(t),oe(n)}function ce(){let e=[];return(0,a.readdirSync)(S.environment.supportPath).forEach(n=>{if((0,ae.extname)(n)==".timer"){let r={name:"",secondsSet:-99,timeLeft:-99,originalFile:n,timeEnds:new Date};r.name=(0,a.readFileSync)(S.environment.supportPath+"/"+n).toString();let s=n.split("---");r.secondsSet=Number(s[1].split(".")[0]);let d=s[0].replace(/__/g,":");r.timeLeft=Math.max(0,Math.round(r.secondsSet-z({d2:d}))),r.timeEnds=new Date(d),r.timeEnds.setSeconds(r.timeEnds.getSeconds()+r.secondsSet),e.push(r)}}),e.sort((n,r)=>n.timeLeft-r.timeLeft),e}function le(e,t){let n=S.environment.supportPath+"/"+e;(0,a.writeFileSync)(n,t)}function N(){(0,a.existsSync)(C)||(0,a.writeFileSync)(C,JSON.stringify({}))}function _(e){N();let t=JSON.parse((0,a.readFileSync)(C,"utf8"));t[(0,se.randomUUID)()]=e,(0,a.writeFileSync)(C,JSON.stringify(t))}function W(){N();let e=JSON.parse((0,a.readFileSync)(C,"utf8"));return Object.fromEntries(Object.entries(e).map(([t,n])=>n.showInMenuBar===void 0?[t,{...n,showInMenuBar:!0}]:[t,n]))}function ue(e,t){N();let n=JSON.parse((0,a.readFileSync)(C,"utf8"));n[e].name=t,(0,a.writeFileSync)(C,JSON.stringify(n))}function de(e){N();let t=JSON.parse((0,a.readFileSync)(C,"utf8"));delete t[e],(0,a.writeFileSync)(C,JSON.stringify(t))}function fe(e){N();let t=JSON.parse((0,a.readFileSync)(C,"utf8")),n=t[e].showInMenuBar;t[e].showInMenuBar=n===void 0?!1:!n,(0,a.writeFileSync)(C,JSON.stringify(t))}var A=require("@raycast/api");function v(){let[e,t]=(0,Y.useState)(void 0),[n,r]=(0,Y.useState)({}),[s,d]=(0,Y.useState)(e===void 0),i=()=>{N();let m=ce();t(m);let w=W();r(w),d(!1)};return{timers:e,customTimers:n,isLoading:s,refreshTimers:i,handleStartTimer:m=>{x(m.launchedFromMenuBar)&&(O(m),i())},handleStopTimer:m=>{t(e?.filter(w=>w.originalFile!==m.originalFile)),me(m.originalFile),i()},handleStartCT:({customTimer:m,launchedFromMenuBar:w})=>{x(w)&&(O({timeInSeconds:m.timeInSeconds,launchedFromMenuBar:w,timerName:m.name,selectedSound:m.selectedSound}),i())},handleCreateCT:m=>{let w={name:m.name,timeInSeconds:m.secondsSet,selectedSound:"default",showInMenuBar:!0};_(w),i()},handleDeleteCT:async m=>{let w={title:"Delete this preset?",icon:A.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:A.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:A.Alert.ActionStyle.Destructive}};await(0,A.confirmAlert)(w)&&(de(m),i())},handleToggleCTVisibility:async m=>{fe(m),i()}}}var l=require("@raycast/api"),j=require("react");var F=require("@raycast/api"),pe=[{title:"Alarm Clock",icon:F.Icon.Alarm,value:"alarmClock.wav"},{title:"Dismembered Woodpecker",icon:F.Icon.Bird,value:"dismemberedWoodpecker.wav"},{title:"Flute Riff",icon:F.Icon.Music,value:"fluteRiff.wav"},{title:"Level Up",icon:F.Icon.Trophy,value:"levelUp.wav"},{title:"Piano Chime",icon:F.Icon.Music,value:"pianoChime.wav"},{title:"Terminator",icon:F.Icon.BarCode,value:"terminator.wav"},{title:"Speak Timer Name",icon:F.Icon.Person,value:"speak_timer_name"}];var y=require("react/jsx-runtime");function K(e){let t=Object.values(e.arguments).some(o=>o!==""),[n,r]=(0,j.useState)(),[s,d]=(0,j.useState)(),[i,p]=(0,j.useState)(),{pop:I}=(0,l.useNavigation)(),R=(0,l.getPreferenceValues)(),D=o=>{if(N(),o.hours===""&&o.minutes===""&&o.seconds==="")new l.Toast({style:l.Toast.Style.Failure,title:"No values set for timer length!"}).show();else if(isNaN(Number(o.hours)))r("Hours must be a number!");else if(isNaN(Number(o.minutes)))d("Minutes must be a number!");else if(isNaN(Number(o.seconds)))p("Seconds must be a number!");else{if(!x())return;let h=o.name?o.name:"Untitled",te=3600*Number(o.hours)+60*Number(o.minutes)+Number(o.seconds);O({timeInSeconds:te,timerName:h,selectedSound:o.selectedSound}).then(()=>I()),o.willBeSaved&&_({name:o.name,timeInSeconds:te,selectedSound:o.selectedSound,showInMenuBar:!0})}},k=()=>{n&&n.length>0&&r(void 0)},G=()=>{s&&s.length>0&&d(void 0)},m=()=>{i&&i.length>0&&p(void 0)},q=[{id:"hours",title:"Hours",placeholder:"0",err:n,drop:k,validator:o=>{let h=o.target.value;isNaN(Number(h))?r("Hours must be a number!"):k()}},{id:"minutes",title:"Minutes",placeholder:"00",err:s,drop:G,validator:o=>{let h=o.target.value;isNaN(Number(h))?d("Minutes must be a number!"):G()}},{id:"seconds",title:"Seconds",placeholder:"00",err:i,drop:m,validator:o=>{let h=o.target.value;isNaN(Number(h))?p("Seconds must be a number!"):m()}}];return R.newTimerInputOrder!=="hhmmss"&&q.reverse(),(0,y.jsxs)(l.Form,{actions:(0,y.jsx)(l.ActionPanel,{children:(0,y.jsx)(l.Action.SubmitForm,{title:"Start Custom Timer",onSubmit:o=>D(o)})}),children:[q.map((o,h)=>(0,y.jsx)(l.Form.TextField,{id:o.id,title:o.title,placeholder:o.placeholder,defaultValue:e.arguments[o.id],error:o.err,onChange:o.drop,onBlur:o.validator},h)),(0,y.jsxs)(l.Form.Dropdown,{id:"selectedSound",defaultValue:"default",title:"Sound",children:[(0,y.jsx)(l.Form.Dropdown.Item,{value:"default",title:"Default"}),pe.map((o,h)=>(0,y.jsx)(l.Form.Dropdown.Item,{title:o.value===R.selectedSound?`${o.title} (currently selected)`:o.title,value:o.value,icon:o.icon},h))]}),(0,y.jsx)(l.Form.TextField,{id:"name",title:"Name",placeholder:"Pour Tea",autoFocus:t}),(0,y.jsx)(l.Form.Checkbox,{id:"willBeSaved",label:"Save as preset"})]})}var f=require("@raycast/api");var $=require("@raycast/api");var g=require("@raycast/api");var he=require("@raycast/api");var b=require("fs");var J=he.environment.supportPath+"/raycast-stopwatches.json",De=()=>{(!(0,b.existsSync)(J)||(0,b.readFileSync)(J).toString()=="")&&(0,b.writeFileSync)(J,"[]")};var Se=(e,t)=>{De();let r=JSON.parse((0,b.readFileSync)(J,"utf8")).map(s=>s.swID==e?{...s,name:t}:s);(0,b.writeFileSync)(J,JSON.stringify(r))};var B=require("react/jsx-runtime");function ge(e){let{pop:t}=(0,g.useNavigation)(),n=r=>{if(r===""||r===e.currentName)new g.Toast({style:g.Toast.Style.Failure,title:"No new name given!"}).show();else{switch(t(),e.originalFile){case"customTimer":ue(e.ctID?e.ctID:"-99",r);break;case"stopwatch":Se(e.ctID?e.ctID:"-99",r);break;default:le(e.originalFile,r);break}V({msg:`Renamed to ${r}!`,launchedFromMenuBar:!1,isErr:!1})}};return(0,B.jsx)(g.Form,{actions:(0,B.jsx)(g.ActionPanel,{children:(0,B.jsx)(g.Action.SubmitForm,{title:"Rename",onSubmit:r=>n(r.newName)})}),children:(0,B.jsx)(g.Form.TextField,{id:"newName",title:"New name",placeholder:e.currentName})})}var X=require("react/jsx-runtime");function H(e){let{push:t}=(0,$.useNavigation)();return(0,X.jsx)($.Action,{title:`Rename ${e.renameLabel}`,icon:$.Icon.TextInput,onAction:()=>t((0,X.jsx)(ge,{currentName:e.currentName,originalFile:e.originalFile,ctID:e.ctID}))})}var M=require("react/jsx-runtime"),Fe={tag:{value:"Running",color:f.Color.Yellow}},Ee={tag:{value:"Finished!",color:f.Color.Green}};function Z({timer:e}){let{handleStopTimer:t,handleCreateCT:n}=v();return(0,M.jsx)(f.List.Item,{icon:{source:f.Icon.Clock,tintColor:e.timeLeft===0?f.Color.Green:f.Color.Yellow},title:e.name,subtitle:L(e.timeLeft)+" left",accessories:[{text:L(e.secondsSet)+" originally"},{text:`${e.timeLeft===0?"Ended":"Ends"} at ${ne(e.timeEnds)}`},e.timeLeft===0?Ee:Fe],actions:(0,M.jsxs)(f.ActionPanel,{children:[(0,M.jsx)(f.Action,{title:"Stop Timer",icon:f.Icon.Stop,onAction:()=>t(e)}),(0,M.jsx)(H,{renameLabel:"Timer",currentName:e.name,originalFile:e.originalFile,ctID:null}),(0,M.jsx)(f.Action,{title:"Save Timer as Preset",icon:f.Icon.SaveDocument,shortcut:{modifiers:["cmd","shift"],key:"enter"},onAction:()=>n(e)})]})})}var T=require("@raycast/api");var E=require("react/jsx-runtime"),Le=e=>`raycast://extensions/ThatNerd/timers/manageTimers?context=${encodeURIComponent(JSON.stringify({timerID:e}))}`;function ee(e){let{handleStartCT:t,handleDeleteCT:n}=v();return(0,E.jsx)(T.List.Item,{icon:T.Icon.Clock,title:e.customTimer.name,subtitle:L(e.customTimer.timeInSeconds),actions:(0,E.jsxs)(T.ActionPanel,{children:[(0,E.jsx)(T.Action,{title:"Start Timer",icon:T.Icon.Hourglass,onAction:()=>t({customTimer:e.customTimer})}),(0,E.jsx)(H,{renameLabel:"Timer",currentName:e.customTimer.name,originalFile:"customTimer",ctID:e.id}),(0,E.jsx)(T.Action,{title:"Delete Custom Timer",icon:T.Icon.Trash,shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>n(e.id)}),(0,E.jsx)(T.Action.CreateQuicklink,{quicklink:{name:e.customTimer.name,link:Le(e.id)},title:"Add Preset to Root Search"})]})})}var P=require("react/jsx-runtime");function we(e){if(e.launchContext?.timerID){let p=W()[e.launchContext.timerID];if(p==null)(0,c.showToast)({style:c.Toast.Style.Failure,title:"This custom timer no longer exists!"});else{O({timeInSeconds:p.timeInSeconds,timerName:p.name,selectedSound:p.selectedSound}).then(()=>(0,c.popToRoot)());return}}let{timers:t,customTimers:n,isLoading:r,refreshTimers:s}=v(),{push:d}=(0,c.useNavigation)();return(0,Te.useEffect)(()=>{s(),setInterval(()=>{s()},1e3)},[]),(0,P.jsxs)(c.List,{isLoading:r,children:[(0,P.jsxs)(c.List.Section,{title:t?.length!==0&&t!=null?"Currently Running":"No Timers Running",children:[t?.map(i=>(0,P.jsx)(Z,{timer:i},i.originalFile)),(0,P.jsx)(c.List.Item,{icon:c.Icon.Clock,title:"Create a new timer",subtitle:"Press Enter to start a timer",actions:(0,P.jsx)(c.ActionPanel,{children:(0,P.jsx)(c.Action,{title:"Start Timer",icon:c.Icon.Hourglass,onAction:()=>d((0,P.jsx)(K,{arguments:{hours:"",minutes:"",seconds:""}}))})})},0)]}),(0,P.jsx)(c.List.Section,{title:"Custom Timers",children:Object.keys(n)?.sort((i,p)=>n[i].timeInSeconds-n[p].timeInSeconds).map(i=>(0,P.jsx)(ee,{customTimer:n[i],id:i},i))})]})}
