"use strict";var O=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var X=Object.prototype.hasOwnProperty;var Z=(e,t)=>{for(var n in t)O(e,n,{get:t[n],enumerable:!0})},ee=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of Q(t))!X.call(e,u)&&u!==n&&O(e,u,{get:()=>t[u],enumerable:!(i=K(t,u))||i.enumerable});return e};var te=e=>ee(O({},"__esModule",{value:!0}),e);var ne={};Z(ne,{default:()=>z});module.exports=te(ne);var D=require("react");var d=require("@raycast/api"),R=require("child_process"),v=require("crypto"),s=require("fs"),J=require("path");var P=e=>{let t=Math.floor(e/3600),n=String(Math.floor(e%3600/60)).padStart(2,"0"),i=String(Math.floor(e%60)).padStart(2,"0");return`${t===0?"":t+":"}${n}:${i}`};var $=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var a=require("@raycast/api"),w=require("fs");var L=e=>{let t=(0,a.getPreferenceValues)();if(e.launchedFromMenuBar||t.closeWindowOnTimerStart){let n=e.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,a.showHUD)(`${n} ${e.msg}`),(0,a.popToRoot)()}else(0,a.showToast)({style:e.isErr?a.Toast.Style.Failure:a.Toast.Style.Success,title:e.msg})},A=async()=>{let e=a.environment.supportPath+"/ringContinuouslyWarningShown";if(!(0,a.getPreferenceValues)().ringContinuously||(0,w.existsSync)(e))return!0;let n=await(0,a.confirmAlert)({title:"Ring Continuously is enabled!",icon:a.Icon.Bell,message:'When the timer rings, you will need to use the "Stop Running Timer" command or stop the timer in the "Manage Timers" command to dismiss the sound. You can configure this in your Raycast settings.'});return n&&(0,w.writeFileSync)(e,""),n};var h=d.environment.supportPath+"/customTimers.json",b=d.environment.supportPath+"/defaultPresetVisibles.json",k=e=>{try{(0,s.unlinkSync)(e)}catch(t){if(t instanceof Error&&!t.message.includes("ENOENT"))throw t}},V=(e=!1)=>{let t=(0,d.getPreferenceValues)();return parseFloat(t.volumeSetting)>5?(L({msg:"Timer alert volume should not be louder than 5 (it can get quite loud!)",launchedFromMenuBar:e,isErr:!0}),!1):!0};async function I({timeInSeconds:e,timerName:t="Untitled",launchedFromMenuBar:n=!1,selectedSound:i="default"}){if(!await A())return;let m=(d.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,s.writeFileSync)(m,t);let c=(0,d.getPreferenceValues)(),y=`${d.environment.assetsPath+"/"+(i==="default"?c.selectedSound:i)}`,p=[`sleep ${e}`];p.push(`if [ -f "${m}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let M=c.selectedSound==="speak_timer_name"?`say ${t}`:`afplay "${y}" --volume ${c.volumeSetting.replace(",",".")}`;if(p.push(M),c.ringContinuously){let T=`${m}`.replace(".timer",".dismiss");(0,s.writeFileSync)(T,".dismiss file for Timers"),p.push(`while [ -f "${T}" ]; do ${M}; done`)}p.push(`rm "${m}"; else echo "Timer deleted"; fi`),(0,R.exec)(p.join(" ; "),(T,r)=>{if(T){console.log(`error: ${T.message}`);return}if(r){console.log(`stderr: ${r}`);return}}),L({msg:`Timer "${t}" started for ${P(e)}!`,launchedFromMenuBar:n,isErr:!1})}function x(e){let t=d.environment.supportPath+"/"+e,n=t.replace(".timer",".dismiss");k(t),k(n)}function H(){let e=[];return(0,s.readdirSync)(d.environment.supportPath).forEach(n=>{if((0,J.extname)(n)==".timer"){let i={name:"",secondsSet:-99,timeLeft:-99,originalFile:n,timeEnds:new Date};i.name=(0,s.readFileSync)(d.environment.supportPath+"/"+n).toString();let u=n.split("---");i.secondsSet=Number(u[1].split(".")[0]);let m=u[0].replace(/__/g,":");i.timeLeft=Math.max(0,Math.round(i.secondsSet-$({d2:m}))),i.timeEnds=new Date(m),i.timeEnds.setSeconds(i.timeEnds.getSeconds()+i.secondsSet),e.push(i)}}),e.sort((n,i)=>n.timeLeft-i.timeLeft),e}function C(){(0,s.existsSync)(h)||(0,s.writeFileSync)(h,JSON.stringify({}))}function _(e){C();let t=JSON.parse((0,s.readFileSync)(h,"utf8"));t[(0,v.randomUUID)()]=e,(0,s.writeFileSync)(h,JSON.stringify(t))}function j(){C();let e=JSON.parse((0,s.readFileSync)(h,"utf8"));return Object.fromEntries(Object.entries(e).map(([t,n])=>n.showInMenuBar===void 0?[t,{...n,showInMenuBar:!0}]:[t,n]))}function W(e){C();let t=JSON.parse((0,s.readFileSync)(h,"utf8"));delete t[e],(0,s.writeFileSync)(h,JSON.stringify(t))}function U(e){C();let t=JSON.parse((0,s.readFileSync)(h,"utf8")),n=t[e].showInMenuBar;t[e].showInMenuBar=n===void 0?!1:!n,(0,s.writeFileSync)(h,JSON.stringify(t))}var Y=()=>{if(!(0,s.existsSync)(b)){let t={"2M":!0,"5M":!0,"10M":!0,"15M":!0,"30M":!0,"45M":!0,"60M":!0,"90M":!0};return(0,s.writeFileSync)(b,JSON.stringify(t)),t}return JSON.parse((0,s.readFileSync)(b,"utf8"))},G=e=>{let t=JSON.parse((0,s.readFileSync)(b,"utf8"));t[e]=!t[e],(0,s.writeFileSync)(b,JSON.stringify(t))};var S=require("@raycast/api");function E(){let[e,t]=(0,D.useState)(void 0),[n,i]=(0,D.useState)({}),[u,m]=(0,D.useState)(e===void 0),c=()=>{C();let o=H();t(o);let g=j();i(g),m(!1)};return{timers:e,customTimers:n,isLoading:u,refreshTimers:c,handleStartTimer:o=>{V(o.launchedFromMenuBar)&&(I(o),c())},handleStopTimer:o=>{t(e?.filter(g=>g.originalFile!==o.originalFile)),x(o.originalFile),c()},handleStartCT:({customTimer:o,launchedFromMenuBar:g})=>{V(g)&&(I({timeInSeconds:o.timeInSeconds,launchedFromMenuBar:g,timerName:o.name,selectedSound:o.selectedSound}),c())},handleCreateCT:o=>{let g={name:o.name,timeInSeconds:o.secondsSet,selectedSound:"default",showInMenuBar:!0};_(g),c()},handleDeleteCT:async o=>{let g={title:"Delete this preset?",icon:S.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:S.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:S.Alert.ActionStyle.Destructive}};await(0,S.confirmAlert)(g)&&(W(o),c())},handleToggleCTVisibility:async o=>{U(o),c()}}}var l=require("@raycast/api"),q=require("react");var F=require("react");function N(){let e=[{key:"2M",title:"2 Minute Timer",seconds:120},{key:"5M",title:"5 Minute Timer",seconds:300},{key:"10M",title:"10 Minute Timer",seconds:600},{key:"15M",title:"15 Minute Timer",seconds:900},{key:"30M",title:"30 Minute Timer",seconds:1800},{key:"45M",title:"45 Minute Timer",seconds:2700},{key:"60M",title:"60 Minute Timer",seconds:3600},{key:"90M",title:"90 Minute Timer",seconds:5400}],[t,n]=(0,F.useState)(),[i,u]=(0,F.useState)(t===void 0),m=()=>{n(Y()),u(!1)};return{defaultPresets:e,defaultVisibles:t,isLoadingVisibles:i,refreshDefaultVisibles:m,handleDefaultPresetToggle:y=>{G(y),m()}}}var f=require("react/jsx-runtime");function z(){let{customTimers:e,isLoading:t,refreshTimers:n,handleToggleCTVisibility:i}=E(),{defaultPresets:u,defaultVisibles:m,isLoadingVisibles:c,refreshDefaultVisibles:y,handleDefaultPresetToggle:p}=N(),M={tag:{value:"Hidden",color:l.Color.Red}},T={tag:{value:"Visible",color:l.Color.Green}};return(0,q.useEffect)(()=>{n(),y()},[]),(0,f.jsxs)(l.List,{isLoading:t&&c,children:[(0,f.jsx)(l.List.Section,{title:"Custom Presets",children:Object.keys(e).sort((r,B)=>e[r].timeInSeconds-e[B].timeInSeconds).map(r=>(0,f.jsx)(l.List.Item,{title:e[r].name,subtitle:P(e[r].timeInSeconds),icon:l.Icon.Clock,accessories:[e[r].showInMenuBar?T:M],actions:(0,f.jsx)(l.ActionPanel,{children:(0,f.jsx)(l.Action,{title:e[r].showInMenuBar?"Hide In Menu Bar":"Show In Menu Bar",onAction:()=>i(r)})})},r))}),(0,f.jsx)(l.List.Section,{title:"Default Presets",children:u.map(r=>(0,f.jsx)(l.List.Item,{title:r.title,icon:l.Icon.Hourglass,accessories:[m?.[r.key]?T:M],actions:(0,f.jsx)(l.ActionPanel,{children:(0,f.jsx)(l.Action,{title:m?.[r.key]?"Hide In Menu Bar":"Show In Menu Bar",onAction:()=>p(r.key)})})},r.key))})]})}
