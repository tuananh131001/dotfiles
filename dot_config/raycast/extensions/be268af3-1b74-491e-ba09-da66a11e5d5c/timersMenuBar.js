"use strict";var B=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var ne=(e,t)=>{for(var n in t)B(e,n,{get:t[n],enumerable:!0})},re=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of ee(t))!te.call(e,u)&&u!==n&&B(e,u,{get:()=>t[u],enumerable:!(r=Z(t,u))||r.enumerable});return e};var ie=e=>re(B({},"__esModule",{value:!0}),e);var se={};ne(se,{default:()=>X});module.exports=ie(se);var m=require("@raycast/api"),Q=require("react");var I=require("react");var f=require("@raycast/api"),R=require("child_process"),v=require("crypto"),i=require("fs"),J=require("path");var y=e=>{let t=Math.floor(e/3600),n=String(Math.floor(e%3600/60)).padStart(2,"0"),r=String(Math.floor(e%60)).padStart(2,"0");return`${t===0?"":t+":"}${n}:${r}`};var V=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var a=require("@raycast/api"),D=require("fs"),k=(e,t)=>(e==null||e.length==0||e.length==null)&&!["always","onlyWhenNotRunning"].includes(t.showMenuBarIconWhen),O=e=>{let t=(0,a.getPreferenceValues)();if(e.launchedFromMenuBar||t.closeWindowOnTimerStart){let n=e.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,a.showHUD)(`${n} ${e.msg}`),(0,a.popToRoot)()}else(0,a.showToast)({style:e.isErr?a.Toast.Style.Failure:a.Toast.Style.Success,title:e.msg})},x=async()=>{let e=a.environment.supportPath+"/ringContinuouslyWarningShown";if(!(0,a.getPreferenceValues)().ringContinuously||(0,D.existsSync)(e))return!0;let n=await(0,a.confirmAlert)({title:"Ring Continuously is enabled!",icon:a.Icon.Bell,message:'When the timer rings, you will need to use the "Stop Running Timer" command or stop the timer in the "Manage Timers" command to dismiss the sound. You can configure this in your Raycast settings.'});return n&&(0,D.writeFileSync)(e,""),n};var g=f.environment.supportPath+"/customTimers.json",b=f.environment.supportPath+"/defaultPresetVisibles.json",A=e=>{try{(0,i.unlinkSync)(e)}catch(t){if(t instanceof Error&&!t.message.includes("ENOENT"))throw t}},E=(e=!1)=>{let t=(0,f.getPreferenceValues)();return parseFloat(t.volumeSetting)>5?(O({msg:"Timer alert volume should not be louder than 5 (it can get quite loud!)",launchedFromMenuBar:e,isErr:!0}),!1):!0};async function L({timeInSeconds:e,timerName:t="Untitled",launchedFromMenuBar:n=!1,selectedSound:r="default"}){if(!await x())return;let c=(f.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,i.writeFileSync)(c,t);let l=(0,f.getPreferenceValues)(),C=`${f.environment.assetsPath+"/"+(r==="default"?l.selectedSound:r)}`,p=[`sleep ${e}`];p.push(`if [ -f "${c}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let w=l.selectedSound==="speak_timer_name"?`say ${t}`:`afplay "${C}" --volume ${l.volumeSetting.replace(",",".")}`;if(p.push(w),l.ringContinuously){let h=`${c}`.replace(".timer",".dismiss");(0,i.writeFileSync)(h,".dismiss file for Timers"),p.push(`while [ -f "${h}" ]; do ${w}; done`)}p.push(`rm "${c}"; else echo "Timer deleted"; fi`),(0,R.exec)(p.join(" ; "),(h,S)=>{if(h){console.log(`error: ${h.message}`);return}if(S){console.log(`stderr: ${S}`);return}}),O({msg:`Timer "${t}" started for ${y(e)}!`,launchedFromMenuBar:n,isErr:!1})}function W(e){let t=f.environment.supportPath+"/"+e,n=t.replace(".timer",".dismiss");A(t),A(n)}function _(){let e=[];return(0,i.readdirSync)(f.environment.supportPath).forEach(n=>{if((0,J.extname)(n)==".timer"){let r={name:"",secondsSet:-99,timeLeft:-99,originalFile:n,timeEnds:new Date};r.name=(0,i.readFileSync)(f.environment.supportPath+"/"+n).toString();let u=n.split("---");r.secondsSet=Number(u[1].split(".")[0]);let c=u[0].replace(/__/g,":");r.timeLeft=Math.max(0,Math.round(r.secondsSet-V({d2:c}))),r.timeEnds=new Date(c),r.timeEnds.setSeconds(r.timeEnds.getSeconds()+r.secondsSet),e.push(r)}}),e.sort((n,r)=>n.timeLeft-r.timeLeft),e}function P(){(0,i.existsSync)(g)||(0,i.writeFileSync)(g,JSON.stringify({}))}function j(e){P();let t=JSON.parse((0,i.readFileSync)(g,"utf8"));t[(0,v.randomUUID)()]=e,(0,i.writeFileSync)(g,JSON.stringify(t))}function U(){P();let e=JSON.parse((0,i.readFileSync)(g,"utf8"));return Object.fromEntries(Object.entries(e).map(([t,n])=>n.showInMenuBar===void 0?[t,{...n,showInMenuBar:!0}]:[t,n]))}function H(e){P();let t=JSON.parse((0,i.readFileSync)(g,"utf8"));delete t[e],(0,i.writeFileSync)(g,JSON.stringify(t))}function Y(e){P();let t=JSON.parse((0,i.readFileSync)(g,"utf8")),n=t[e].showInMenuBar;t[e].showInMenuBar=n===void 0?!1:!n,(0,i.writeFileSync)(g,JSON.stringify(t))}var q=()=>{if(!(0,i.existsSync)(b)){let t={"2M":!0,"5M":!0,"10M":!0,"15M":!0,"30M":!0,"45M":!0,"60M":!0,"90M":!0};return(0,i.writeFileSync)(b,JSON.stringify(t)),t}return JSON.parse((0,i.readFileSync)(b,"utf8"))},G=e=>{let t=JSON.parse((0,i.readFileSync)(b,"utf8"));t[e]=!t[e],(0,i.writeFileSync)(b,JSON.stringify(t))};var M=require("@raycast/api");function F(){let[e,t]=(0,I.useState)(void 0),[n,r]=(0,I.useState)({}),[u,c]=(0,I.useState)(e===void 0),l=()=>{P();let o=_();t(o);let T=U();r(T),c(!1)};return{timers:e,customTimers:n,isLoading:u,refreshTimers:l,handleStartTimer:o=>{E(o.launchedFromMenuBar)&&(L(o),l())},handleStopTimer:o=>{t(e?.filter(T=>T.originalFile!==o.originalFile)),W(o.originalFile),l()},handleStartCT:({customTimer:o,launchedFromMenuBar:T})=>{E(T)&&(L({timeInSeconds:o.timeInSeconds,launchedFromMenuBar:T,timerName:o.name,selectedSound:o.selectedSound}),l())},handleCreateCT:o=>{let T={name:o.name,timeInSeconds:o.secondsSet,selectedSound:"default",showInMenuBar:!0};j(T),l()},handleDeleteCT:async o=>{let T={title:"Delete this preset?",icon:M.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:M.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:M.Alert.ActionStyle.Destructive}};await(0,M.confirmAlert)(T)&&(H(o),l())},handleToggleCTVisibility:async o=>{Y(o),l()}}}var z=(e,t)=>{if(e===void 0||e?.length===0||e.length==null)return;let n="timeLeft"in e[0]?e[0].timeLeft:e[0].timeElapsed;return t.showTitleInMenuBar?`${e[0].name}: ~${y(n)}`:`~${y(n)}`},K=(e,t,n)=>{switch(t.showMenuBarIconWhen){case"always":return n;case"never":return;case"onlyWhenRunning":return e!==void 0&&e?.length>0?n:void 0;case"onlyWhenNotRunning":return e===void 0||e?.length===0?n:void 0}};var $=require("react");function N(){let e=[{key:"2M",title:"2 Minute Timer",seconds:120},{key:"5M",title:"5 Minute Timer",seconds:300},{key:"10M",title:"10 Minute Timer",seconds:600},{key:"15M",title:"15 Minute Timer",seconds:900},{key:"30M",title:"30 Minute Timer",seconds:1800},{key:"45M",title:"45 Minute Timer",seconds:2700},{key:"60M",title:"60 Minute Timer",seconds:3600},{key:"90M",title:"90 Minute Timer",seconds:5400}],[t,n]=(0,$.useState)(),[r,u]=(0,$.useState)(t===void 0),c=()=>{n(q()),u(!1)};return{defaultPresets:e,defaultVisibles:t,isLoadingVisibles:r,refreshDefaultVisibles:c,handleDefaultPresetToggle:C=>{G(C),c()}}}var d=require("react/jsx-runtime");function X(){let{timers:e,customTimers:t,isLoading:n,refreshTimers:r,handleStartTimer:u,handleStopTimer:c,handleStartCT:l}=F(),{defaultPresets:C,defaultVisibles:p,refreshDefaultVisibles:w,isLoadingVisibles:h}=N();(0,Q.useEffect)(()=>{r(),w(),setInterval(()=>{r()},1e3)},[]),n&&r();let S=(0,m.getPreferenceValues)();return k(e,S)?null:(0,d.jsxs)(m.MenuBarExtra,{icon:K(e,S,m.Icon.Clock),isLoading:n&&h,title:z(e,S),children:[(0,d.jsx)(m.MenuBarExtra.Item,{title:"Click running timer to stop"}),e?.map(s=>(0,d.jsx)(m.MenuBarExtra.Item,{title:s.name+": "+y(s.timeLeft)+" left",onAction:()=>c(s)},s.originalFile)),(0,d.jsx)(m.MenuBarExtra.Section,{children:Object.keys(t)?.sort((s,o)=>t[s].timeInSeconds-t[o].timeInSeconds).filter(s=>t[s].showInMenuBar).map(s=>(0,d.jsx)(m.MenuBarExtra.Item,{title:'Start "'+t[s].name+'"',onAction:()=>l({customTimer:t[s],launchedFromMenuBar:!0})},s))}),(0,d.jsx)(m.MenuBarExtra.Section,{children:C.filter(s=>p?.[s.key]).map(s=>(0,d.jsx)(m.MenuBarExtra.Item,{title:`Start ${s.title}`,onAction:()=>u({timeInSeconds:s.seconds,timerName:s.title,launchedFromMenuBar:!0})},s.key))}),(0,d.jsx)(m.MenuBarExtra.Section,{title:"Custom Timer",children:(0,d.jsx)(m.MenuBarExtra.Item,{title:"Start Custom Timer",onAction:async()=>await(0,m.launchCommand)({name:"startCustomTimer",type:m.LaunchType.UserInitiated})},"custom")})]})}
